<div class="mainContent">
    <div class="">
        <button id="createBut" type="button" class="btn green">新增</button>
    </div>
    <div class="userTable" id="searchResult">
        <div class="userRow userHeader">
            <span class="userItem5-1">用户名</span>
            <span class="userItem5-1">备注</span>
            <span class="userItem6">操作</span>
        </div>
    </div>
    <div class="pageBox">
        <input type="hidden" id="pageNum"/>
    </div>
    <div class="mask"></div>
    <div id="userInfo" class="dialogueBox">
        <div class="dialogueHeader">
            <span>新增用户</span>
            <span class="dialogueClose">
				<i class="fa fa-window-close"></i>
			</span>
        </div>
        <div class="dialogueBody">
            <form id="userForm" class="needs-validation">
                <div class="formLine">
                    <div class="formDiv">
						<span>
							用户名：<i>*</i>
						</span>
                        <span>
							<input type="text" id="userName" name="userName" placeholder="用户名"
                                   class="form-control placeholder-no-fix" required autocomplete="off"/>
						</span>
                    </div>
                </div>
                <div class="formLine">
                    <div class="formDiv">
                        <span>备注：</span>
                        <span>
							<input type="text" id="userDesc" name="userDesc" placeholder="备注"
                                   class="form-control placeholder-no-fix" autocomplete="off"/>
						</span>
                    </div>
                </div>
            </form>
        </div>
        <div class="dialogueFooter">
            <button id="saveUser" type="button" class="btn blue">保存</button>
            <button id="closeUser" type="button" class="btn gray">取消</button>
        </div>
    </div>

    <script type="text/javascript">
        $('#createBut').click(function () {
            edit(0);
        });

        function search(pageNum) {
            const url = 'user/list';
            $.getJSON(
                url,
                {
                    'pageNum': pageNum,
                    'pageSize': 13
                },
                function (data) {
                    setPage(data, $(".pageBox"), $("#pageNum"));
                    $("#searchResult .userHeader").nextAll().remove();
                    $.each(data.content, function (i, n) {
                        $("#searchResult").append('<div class="userRow"><span class="userItem5-1">'
                            + n.userName
                            + '</span><span class="userItem5-1">'
                            + n.userDesc
                            + '</span><span class="userItem6"><button type="button" class="btn blue" onclick="resetPsw(\''
                            + n.userId
                            + '\')">重置密码</button></span></div>');
                    });
                });
        }

        function edit(userId) {
            $("#userName").val("");
            $("#userDesc").val("");
            dialogueOpen("userInfo");
        }

        function resetPsw(userId) {
            $.getJSON("user/reset", {"userId" : userId}, function(message) {
                layer.msg(message.content, {
                    time: 2000
                });
            });
        }

        $(".dialogueClose").click(function () {
            dialogueClose($(this).parent().parent().attr("id"));
        });

        $("#closeUser").click(function () {
            dialogueClose("userInfo");
        });

        $("#saveUser").click(function () {
            $("form#userForm").submit();
        });

        $(function () {
            $("form#userForm.needs-validation").validate({
                submitHandler: function (form) {
                    $(form).ajaxSubmit({
                        type: 'post',
                        url: "user/create",
                        dataType: "json",
                        success: function (result) { //表单提交后更新页面显示的数据
                            dialogueClose("userInfo");
                            search(1);
                            layer.msg(result.content, {
                                time: 2000
                            });
                        }
                    });
                },
                rules: {
                    "userName": {
                        remote: {
                            url: "user/checkUserName",     //后台处理程序
                            type: "get",               //数据发送方式
                            dataType: "json",           //接受数据格式
                            data: {                     //要传递的数据
                                userName: function () {
                                    return $("#userName").val();
                                }
                            }
                        }
                    }
                },
                messages: {
                    "userName": {
                        remote: "用户名已被使用,请重新输入"
                    }
                }
            });
        });

        $(function () {
            search(1);
            $("#inputResult").hide();
            $("#index-page-title").html("用户管理");
            $("#current-page-title").html("用户管理");
        });
    </script>
</div>